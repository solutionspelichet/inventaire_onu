<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Inventaire ONU</title>
  <meta name="description" content="PWA Inventaire ONU — scanner et enregistrer des mouvements dans Google Sheets." />
  <meta name="theme-color" content="#111111" />
  <meta name="robots" content="noindex,nofollow" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Librairies de scan (obligatoires) -->
  <script defer src="https://unpkg.com/@zxing/library@0.20.0"></script>
  <script defer src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>

  <!-- App -->
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>Inventaire ONU</h1>
    <button id="btn-install" class="ghost" aria-label="Installer l’app (PWA)" hidden>Installer</button>
  </header>

  <main>
    <!-- Cadre-guide -->
    <section class="card">
      <h2>Scanner (mode photo)</h2>
      <div class="guide-wrap">
        <div class="guide-toolbar">
          <span class="muted">Cadre-guide</span>
          <div class="guide-switch">
            <button type="button" id="guide-qr" class="ghost small" aria-pressed="true">QR</button>
            <button type="button" id="guide-barcode" class="ghost small" aria-pressed="false">Code-barres</button>
          </div>
        </div>

        <div class="guide-stage">
          <div class="guide-frame guide-qr" id="guide-frame" aria-hidden="true">
            <div class="guide-corners"></div>
            <p class="guide-hint">Visez le code dans le cadre, puis touchez “Scanner (photo)”.</p>
          </div>
        </div>
      </div>

      <!-- Lanceur caméra via icône -->
      <div class="capture-wrap">
        <button id="btn-capture" type="button" class="capture-btn" aria-label="Prendre une photo du code">
          <!-- Icône code-barres + trait rouge -->
          <svg viewBox="0 0 160 80" aria-hidden="true" class="barcode-icon">
            <rect x="8"  y="12" width="6"  height="56" fill="currentColor" opacity="0.85"/>
            <rect x="18" y="12" width="3"  height="56" fill="currentColor" opacity="0.75"/>
            <rect x="24" y="12" width="8"  height="56" fill="currentColor"/>
            <rect x="36" y="12" width="4"  height="56" fill="currentColor" opacity="0.7"/>
            <rect x="44" y="12" width="10" height="56" fill="currentColor"/>
            <rect x="58" y="12" width="3"  height="56" fill="currentColor" opacity="0.7"/>
            <rect x="64" y="12" width="7"  height="56" fill="currentColor"/>
            <rect x="75" y="12" width="4"  height="56" fill="currentColor" opacity="0.7"/>
            <rect x="82" y="12" width="9"  height="56" fill="currentColor"/>
            <rect x="95" y="12" width="3"  height="56" fill="currentColor" opacity="0.7"/>
            <rect x="100" y="12" width="6" height="56" fill="currentColor"/>
            <rect x="110" y="12" width="4" height="56" fill="currentColor" opacity="0.7"/>
            <rect x="118" y="12" width="10" height="56" fill="currentColor"/>
            <rect x="132" y="12" width="4" height="56" fill="currentColor" opacity="0.7"/>
            <!-- trait rouge de visée -->
            <rect x="0" y="38" width="160" height="4" fill="#ff3b30"/>
          </svg>
          <span>Scanner (photo)</span>
        </button>

        <!-- input fichier masqué (ouvre l’appareil photo) -->
        <input id="photoInput" type="file" accept="image/*" capture="environment" class="visually-hidden" />
      </div>

      <!-- Aperçu + canvas -->
      <div id="preview-wrap" class="video-wrap">
        <img id="preview" alt="Aperçu" style="display:none;max-width:100%;height:auto;border-radius:10px;" />
        <canvas id="canvas" class="hidden" aria-hidden="true"></canvas>
        <div id="flash" class="flash" aria-hidden="true"></div>
        <div id="status" class="status" role="status" aria-live="polite">Prêt.</div>
      </div>
    </section>

    <!-- Formulaire -->
    <section class="card">
      <h2>Formulaire</h2>
      <form id="form">
        <div class="field">
          <label for="code">Code scanné</label>
          <input id="code" name="code" type="text" inputmode="text" autocomplete="off" required />
        </div>

        <div class="field">
          <label for="from">Emplacement de départ</label>
          <input id="from" name="from" type="text" autocomplete="off" placeholder="ex : Voie Creuse" required />
        </div>

        <div class="field">
          <label for="to">Emplacement de destination</label>
          <input id="to" name="to" type="text" autocomplete="off" placeholder="ex : Bibliothèque" required />
        </div>

        <div class="field">
          <label for="type">Type de mobilier</label>
          <select id="type" name="type" required>
            <option value="">— Choisir —</option>
            <option>Bureau</option>
            <option>Chaise</option>
            <option>Armoire</option>
            <option>Caisson roulant</option>
            <option>Table de réunion</option>
            <option>Table basse</option>
            <option>Cabine acoustique</option>
            <option>Poste informatique</option>
            <option>Canapé</option>
            <option>Vestiaire</option>
            <option value="Autre">Autre…</option>
          </select>
        </div>

        <div class="field" id="field-type-autre" hidden>
          <label for="type_autre">Type (autre)</label>
          <input id="type_autre" name="type_autre" type="text" autocomplete="off" placeholder="Saisir le type" />
        </div>

        <div class="field">
          <label for="date_mvt">Date du mouvement</label>
          <input id="date_mvt" name="date_mvt" type="date" required />
        </div>

        <div class="actions">
          <button type="submit">Enregistrer</button>
          <button type="button" id="btn-test" class="ghost">Test (mock)</button>
        </div>

        <p id="api-msg" class="muted" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <footer class="foot">
    <small>© Inventaire ONU — PWA démo • Dark mode</small>
  </footer>
</body>
</html>
